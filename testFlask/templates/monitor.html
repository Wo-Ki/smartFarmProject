{% extends "base.html" %}
{% block title %}
    大棚内历史信息
{% endblock %}
{% block head %}
    <style>
        .over {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            z-index: 100;
        }

        .tempContainer {
            position: fixed;
            width: 100%;
            margin-right: 0px;
            margin-left: 0px;
            text-align: center;
            z-index: 101;
        }
    </style>
{% endblock %}

{% block main %}
    <br>
    <br>
    <div class="container">
        <div class="page-header">
            <h1>监控平台
                <small>flying</small>
            </h1>
        </div>
    </div>
    <div class="panel panel-primary">
        <div class="panel-heading"><h4>实时监控</h4></div>
        <div class="panel-body">
            <div class="embed-responsive embed-responsive-16by9"
                 style="width: 100%;height: 500px;background-color: gold">
                {#                        <iframe class="embed-responsive-item" src="{{ url_for("monitorDataGreenhouse") }}" height=50%></iframe>#}
            </div>
        </div>
    </div>




    {#    <ul>#}
    {#        {% for img in imgs %}#}
    {#            <li>#}
    {#                <img src="data:;base64,{{ base64.b64encode(img.imgData) }}" alt="图片"#}
    {#                     class="img-rounded pull-left img-responsive">#}
    {#            </li>#}
    {#        {% endfor %}#}
    {#    </ul>#}
    <div class="panel panel-primary">
        <div class="panel-heading clearfix">
            <h4 class="pull-left" id="his">历史记录</h4>
            <form action="{{ url_for("monitor") }}" method="post" class="form-inline pull-right" id="findPic">
                <select class="form-control" name="datePick">
                    <option value="option01">一天内</option>
                    <option value="option02">一周内</option>
                    <option value="option03">一个月内</option>
                    <option value="option04">所有</option>
                </select>
                <button type="submit" class="btn btn-default" href="#his">查询</button>
            </form>
        </div>
        <div class="panel-body">

            {% if not imgsData %}
                <h4 class="text-center">无历史记录，请点击
                    <button form="findPic" class="btn btn-default" href="#his">查询</button>
                </h4>

            {% else %}
                <div class="row">
                    {% for value in imgsData %}

                        <div class="col-xs-6 col-md-3" style="margin-bottom: 5px">
                            <p>{{ value.create_time }}</p>
                            <img src="data:;base64,{{ base64.b64encode(value.imgData) }}" alt="hisPic"
                                 class="img-rounded pull-left img-responsive" id="hisPic"
                                 style="cursor: pointer;"
                            >
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>

    <div class="modal fade" tabindex="-2" role="dialog" id="picModel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">详情</h4>
                </div>
                <div class="modal-body">
                    <div class="center-block" align="center"><img src="#" alt="detail" id="detailPic"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-danger" tabindex="0" title="确定？"
                            data-toggle="popover" data-placement="top" data-container="body"
                            data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">删除
                    </button>
                    {#                    <button type="button" class="btn btn-primary">保存</button>#}
                    <a href="#" download="#" class="btn btn-primary" id="picSave">保存</a>

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <script>
        window.location.href = "#his";
        $('img[alt=hisPic]').click(function () {
            {#            alert("hah");#}
            {#            $(this).toggleClass('min');#}
            {#            $(this).toggleClass('max');#}
            $("#detailPic").attr({"src": $(this).attr("src")});
            $("#picSave").attr({"href": $(this).attr("src"), "download": $(this).prev("p").html() + ".png"});
            $(this).attr({"data-toggle": "modal", "data-target": "#picModel"});
            {#            console.log($(this).attr("src"));#}
        });
    </script>
{% endblock %}